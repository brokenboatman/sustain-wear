// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId     Int     @id @default(autoincrement())
  email      String  @unique
  username   String  @unique
  password   String?
  googleId   String? @unique
  roleId     Int
  charityId  Int?
  profileURL String?

  // --- Relations ---
  role          Role            @relation(fields: [roleId], references: [roleId])
  charity       Charity?        @relation(fields: [charityId], references: [charityId])
  donations     Donation[]
  notifications Notifications[] // Add this so you can do: prisma.user.find({ include: { notifications: true } })
}

model Role {
  roleId   Int    @id @default(autoincrement())
  roleName String @unique

  // --- Relations ---
  users User[]
}

model Charity {
  charityId Int    @id @default(autoincrement())
  name      String
  city      String
  address   String

  // --- Relations ---
  users     User[]
  donations Donation[]
}

model Status {
  statusId Int    @id @default(autoincrement())
  status   String @unique

  // --- Relations ---
  // Updated: Points to Donation, removed DonationItem
  donations Donation[] 
}

model Notifications {
  notificationId     Int      @id @default(autoincrement())
  userId             Int
  notificationTypeId Int
  message            String
  isRead             Boolean  @default(false) // Best practice: default to false (unread)
  createdAt          DateTime @default(now()) // Best practice: automatically set time

  // --- Relations ---
  user             User             @relation(fields: [userId], references: [userId], onDelete: Cascade)
  notificationType NotificationType @relation(fields: [notificationTypeId], references: [notificationTypeId])
}

model NotificationType {
  notificationTypeId Int    @id @default(autoincrement())
  type               String @unique // e.g., "DONATION_MILESTONE", "SYSTEM_ALERT"

  // --- Relations ---
  notifications Notifications[] // Inverse relation: One type can be on many notifications
}

model Donation {
  donationId  Int      @id @default(autoincrement())
  userId      Int      
  charityId   Int
  statusId    Int
  title   String
  date        DateTime @default(now())
  photoUrl    String?
  description String?
  quantity    Int      @default(1)
  weight      Float?   
  co2         Float?   
  colourId    Int
  conditionId Int
  genderId    Int
  categoryId  Int
  materialId  Int
  sizeId      Int
  images DonationImage[]


  user User @relation(fields: [userId], references: [userId], onDelete: Cascade)
  charity   Charity   @relation(fields: [charityId], references: [charityId])
  status    Status    @relation(fields: [statusId], references: [statusId])
  
  colour    Colour    @relation(fields: [colourId], references: [colourId])
  condition Condition @relation(fields: [conditionId], references: [conditionId])
  gender    Gender    @relation(fields: [genderId], references: [genderId])
  category  Category  @relation(fields: [categoryId], references: [categoryId])
  material  Material  @relation(fields: [materialId], references: [materialId])
  size      Size      @relation(fields: [sizeId], references: [sizeId])
}

model DonationImage {
  imageId    Int      @id @default(autoincrement())
  url        String
  donationId Int
  donation Donation @relation(fields: [donationId], references: [donationId], onDelete: Cascade)
}

// --- Lookup Tables ---

model Colour {
  colourId Int    @id @default(autoincrement())
  colour   String @unique

  // --- Relations ---
  donations Donation[] // Renamed from donationItems
}

model Condition {
  conditionId Int    @id @default(autoincrement())
  condition   String @unique

  // --- Relations ---
  donations Donation[] // Renamed from donationItems
}

model Gender {
  genderId Int    @id @default(autoincrement())
  gender   String @unique

  // --- Relations ---
  donations Donation[] // Renamed from donationItems
}

model Category {
  categoryId Int    @id @default(autoincrement())
  category   String @unique

  // --- Relations ---
  donations Donation[] // Renamed from donationItems
}

model Material {
  materialId Int    @id @default(autoincrement())
  material   String @unique

  // --- Relations ---
  donations Donation[] // Renamed from donationItems
}

model Size {
  sizeId Int    @id @default(autoincrement())
  size   String @unique

  // --- Relations ---
  donations Donation[] // Renamed from donationItems
}